/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * PanelOpcPOIs.java
 *
 * Created on 19/04/2012, 01:46:19
 */
package gui;

import controllers.ControllerNavegacion;
import controllers.ControllerPpal;
import java.util.ArrayList;
import javax.swing.JComboBox;
import javax.swing.JOptionPane;
import javax.swing.JTable;
import javax.swing.table.DefaultTableModel;
import modelo.dataManager.CategoriaPoi;
import modelo.dataManager.POI;
import persistencia.BrokerCategoriasPOI;
import persistencia.BrokerPOIs;
import persistencia.BrokerPpal;

/**
 *
 * @author Sebastian
 */
public class PanelOpcPOIs extends javax.swing.JPanel {

    static PanelOpcPOIs unicaInstancia;
    private boolean modificandoPOI;
    private DefaultTableModel modeloTablaPOIS = new javax.swing.table.DefaultTableModel(
            new Object[][]{},
            new String[]{
                "id", "Fecha y Hora", "Categoria", "Coordenadas", "Descripcion", "Acciones"
            }) {

        Class[] types = new Class[]{
            java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Boolean.class
        };

        @Override
        public Class getColumnClass(int columnIndex) {
            return types[columnIndex];
        }
    };
    private DefaultTableModel modeloTablaCategoriasPOI = new javax.swing.table.DefaultTableModel(
            new Object[][]{},
            new String[]{
                "id", "Nombre de Categoria", "Icono", "Acciones"
            }) {

        Class[] types = new Class[]{
            java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Boolean.class
        };

        @Override
        public Class getColumnClass(int columnIndex) {
            return types[columnIndex];
        }
    };
    ;
    private boolean agregandoPOI;
    private POI tempPOI;

    /** Creates new form PanelOpcPOIs */
    private PanelOpcPOIs() {
        initComponents();
        inicializador();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jScrollPane3 = new javax.swing.JScrollPane();
        panelTodo = new org.jdesktop.swingx.JXPanel();
        panelTitulo = new org.jdesktop.swingx.JXPanel();
        lblTitulo = new org.jdesktop.swingx.JXLabel();
        panelPois = new org.jdesktop.swingx.JXPanel();
        panelPoisTitulo = new org.jdesktop.swingx.JXPanel();
        lblTituloTablaPois = new org.jdesktop.swingx.JXLabel();
        panelTablaPois = new org.jdesktop.swingx.JXPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        tablaPois = new org.jdesktop.swingx.JXTable();
        panelSur = new org.jdesktop.swingx.JXPanel();
        panelAccionesCampElegida = new org.jdesktop.swingx.JXPanel();
        lblAccionesCampania = new org.jdesktop.swingx.JXLabel();
        panelAcciones = new org.jdesktop.swingx.JXPanel();
        btnModificar = new org.jdesktop.swingx.JXHyperlink();
        btnGuardar = new org.jdesktop.swingx.JXHyperlink();
        btnEliminar = new org.jdesktop.swingx.JXHyperlink();
        btnInsertar = new org.jdesktop.swingx.JXHyperlink();
        panelDatosPoi = new org.jdesktop.swingx.JXPanel();
        panelLatitud = new org.jdesktop.swingx.JXPanel();
        lblLatitud = new org.jdesktop.swingx.JXLabel();
        campoLatitud = new javax.swing.JTextField();
        panelLongitud = new org.jdesktop.swingx.JXPanel();
        lblLongitud = new org.jdesktop.swingx.JXLabel();
        campoLongitud = new javax.swing.JTextField();
        panelCatNuevoPoi = new org.jdesktop.swingx.JXPanel();
        lblCategoria = new org.jdesktop.swingx.JXLabel();
        comboCategorias = new javax.swing.JComboBox();
        panelDescripNuevoPoi = new org.jdesktop.swingx.JXPanel();
        lblDescripci칩nNuevoPoi = new org.jdesktop.swingx.JXLabel();
        campoDescripcionNuevoPoi = new javax.swing.JTextField();
        panelBtnAgregaPoi = new org.jdesktop.swingx.JXPanel();
        btnAgregaPoi = new javax.swing.JButton();
        panelCategoriaPois = new org.jdesktop.swingx.JXPanel();
        panelCatTitulo = new org.jdesktop.swingx.JXPanel();
        lblTituloTablaCategorias = new org.jdesktop.swingx.JXLabel();
        panelTablaCategorias = new org.jdesktop.swingx.JXPanel();
        jScrollPane2 = new javax.swing.JScrollPane();
        tablaCategorias = new org.jdesktop.swingx.JXTable();
        panelAgregaCategoria = new org.jdesktop.swingx.JXPanel();
        panelNombreNuevaCat = new org.jdesktop.swingx.JXPanel();
        lblNombreNuevaCat = new org.jdesktop.swingx.JXLabel();
        campoNombreNuevaCat = new javax.swing.JTextField();
        panelBtnAgregaCategoria = new org.jdesktop.swingx.JXPanel();
        btnAgregaCategoria = new javax.swing.JButton();

        setMaximumSize(new java.awt.Dimension(500, 500));
        setMinimumSize(new java.awt.Dimension(500, 500));
        setPreferredSize(new java.awt.Dimension(520, 500));
        setLayout(new java.awt.BorderLayout());

        jScrollPane3.setAutoscrolls(true);
        jScrollPane3.setPreferredSize(new java.awt.Dimension(520, 500));

        panelTodo.setMinimumSize(new java.awt.Dimension(400, 360));
        panelTodo.setPreferredSize(new java.awt.Dimension(500, 670));
        panelTodo.setScrollableTracksViewportHeight(false);
        panelTodo.setScrollableTracksViewportWidth(false);

        panelTitulo.setMaximumSize(new java.awt.Dimension(500, 40));
        panelTitulo.setMinimumSize(new java.awt.Dimension(500, 40));
        panelTitulo.setPreferredSize(new java.awt.Dimension(500, 40));

        lblTitulo.setText("Administraci칩n de Puntos de Interes (POI)");
        lblTitulo.setFont(new java.awt.Font("Arial", 0, 18));
        panelTitulo.add(lblTitulo);

        panelTodo.add(panelTitulo);

        panelPois.setMaximumSize(new java.awt.Dimension(500, 450));
        panelPois.setMinimumSize(new java.awt.Dimension(500, 450));
        panelPois.setPreferredSize(new java.awt.Dimension(500, 450));
        panelPois.setLayout(new java.awt.BorderLayout());

        panelPoisTitulo.setMaximumSize(new java.awt.Dimension(500, 30));
        panelPoisTitulo.setMinimumSize(new java.awt.Dimension(500, 30));
        panelPoisTitulo.setPreferredSize(new java.awt.Dimension(500, 30));
        panelPoisTitulo.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT));

        lblTituloTablaPois.setText("Listado de POIs:");
        lblTituloTablaPois.setFont(new java.awt.Font("Tahoma", 0, 14));
        panelPoisTitulo.add(lblTituloTablaPois);

        panelPois.add(panelPoisTitulo, java.awt.BorderLayout.NORTH);

        panelTablaPois.setMaximumSize(new java.awt.Dimension(500, 200));
        panelTablaPois.setMinimumSize(new java.awt.Dimension(500, 200));
        panelTablaPois.setPreferredSize(new java.awt.Dimension(500, 200));
        panelTablaPois.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.CENTER, 0, 0));

        jScrollPane1.setMaximumSize(new java.awt.Dimension(500, 250));
        jScrollPane1.setMinimumSize(new java.awt.Dimension(500, 250));
        jScrollPane1.setPreferredSize(new java.awt.Dimension(500, 200));

        tablaPois.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Fecha y Hora", "Categoria", "Coordenadas", "Descripcion"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.Object.class, java.lang.String.class, java.lang.Object.class, java.lang.String.class
            };
            boolean[] canEdit = new boolean [] {
                false, false, false, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane1.setViewportView(tablaPois);
        tablaPois.getColumnModel().getColumn(0).setMinWidth(70);
        tablaPois.getColumnModel().getColumn(0).setPreferredWidth(70);

        panelTablaPois.add(jScrollPane1);

        panelPois.add(panelTablaPois, java.awt.BorderLayout.CENTER);

        panelSur.setMaximumSize(new java.awt.Dimension(500, 150));
        panelSur.setMinimumSize(new java.awt.Dimension(500, 150));
        panelSur.setPreferredSize(new java.awt.Dimension(500, 200));

        panelAccionesCampElegida.setMaximumSize(new java.awt.Dimension(450, 30));
        panelAccionesCampElegida.setMinimumSize(new java.awt.Dimension(450, 30));
        panelAccionesCampElegida.setPreferredSize(new java.awt.Dimension(450, 30));
        panelAccionesCampElegida.setLayout(new java.awt.GridLayout(1, 2));

        lblAccionesCampania.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblAccionesCampania.setText("Acciones sobre la campa침a elegida:");
        lblAccionesCampania.setFont(new java.awt.Font("Tahoma", 0, 14));
        panelAccionesCampElegida.add(lblAccionesCampania);

        panelAcciones.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 20, 5));

        btnModificar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imgs/tabla-icono-editar.png"))); // NOI18N
        btnModificar.setText("");
        btnModificar.setToolTipText("Modificar campa침a");
        btnModificar.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        btnModificar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnModificarActionPerformed(evt);
            }
        });
        panelAcciones.add(btnModificar);

        btnGuardar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imgs/tabla-icono-guardar.png"))); // NOI18N
        btnGuardar.setText("");
        btnGuardar.setToolTipText("Guardar cambios");
        btnGuardar.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        btnGuardar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnGuardarActionPerformed(evt);
            }
        });
        panelAcciones.add(btnGuardar);

        btnEliminar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imgs/tabla-icono-eliminar.png"))); // NOI18N
        btnEliminar.setText("");
        btnEliminar.setToolTipText("Eliminar campa침a");
        btnEliminar.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        btnEliminar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnEliminarActionPerformed(evt);
            }
        });
        panelAcciones.add(btnEliminar);

        btnInsertar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imgs/tabla-icono-insertar.png"))); // NOI18N
        btnInsertar.setText("");
        btnInsertar.setToolTipText("Eliminar campa침a");
        btnInsertar.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        btnInsertar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnInsertarActionPerformed(evt);
            }
        });
        panelAcciones.add(btnInsertar);

        panelAccionesCampElegida.add(panelAcciones);

        panelSur.add(panelAccionesCampElegida);

        panelDatosPoi.setMaximumSize(new java.awt.Dimension(500, 150));
        panelDatosPoi.setMinimumSize(new java.awt.Dimension(500, 150));
        panelDatosPoi.setPreferredSize(new java.awt.Dimension(500, 150));
        panelDatosPoi.setLayout(new java.awt.GridLayout(5, 1));

        lblLatitud.setText("Latitud ");
        lblLatitud.setFont(new java.awt.Font("Tahoma", 0, 12));
        panelLatitud.add(lblLatitud);

        campoLatitud.setMaximumSize(new java.awt.Dimension(100, 20));
        campoLatitud.setMinimumSize(new java.awt.Dimension(100, 20));
        campoLatitud.setPreferredSize(new java.awt.Dimension(100, 20));
        panelLatitud.add(campoLatitud);

        panelDatosPoi.add(panelLatitud);

        lblLongitud.setText("Longitud");
        lblLongitud.setFont(new java.awt.Font("Tahoma", 0, 12));
        panelLongitud.add(lblLongitud);

        campoLongitud.setMaximumSize(new java.awt.Dimension(100, 20));
        campoLongitud.setMinimumSize(new java.awt.Dimension(100, 20));
        campoLongitud.setPreferredSize(new java.awt.Dimension(100, 20));
        panelLongitud.add(campoLongitud);

        panelDatosPoi.add(panelLongitud);

        panelCatNuevoPoi.setMaximumSize(new java.awt.Dimension(500, 30));
        panelCatNuevoPoi.setMinimumSize(new java.awt.Dimension(500, 30));
        panelCatNuevoPoi.setPreferredSize(new java.awt.Dimension(500, 30));

        lblCategoria.setText("Categoria");
        lblCategoria.setFont(new java.awt.Font("Tahoma", 0, 12));
        panelCatNuevoPoi.add(lblCategoria);

        comboCategorias.setFont(new java.awt.Font("Tahoma", 0, 12));
        comboCategorias.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Red rota", "Buen Abadejo", "Fondo rocoso" }));
        comboCategorias.setMaximumSize(new java.awt.Dimension(130, 20));
        comboCategorias.setMinimumSize(new java.awt.Dimension(130, 20));
        comboCategorias.setPreferredSize(new java.awt.Dimension(130, 20));
        comboCategorias.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                comboCategoriasActionPerformed(evt);
            }
        });
        panelCatNuevoPoi.add(comboCategorias);

        panelDatosPoi.add(panelCatNuevoPoi);

        panelDescripNuevoPoi.setMaximumSize(new java.awt.Dimension(500, 30));
        panelDescripNuevoPoi.setMinimumSize(new java.awt.Dimension(500, 30));
        panelDescripNuevoPoi.setPreferredSize(new java.awt.Dimension(500, 30));

        lblDescripci칩nNuevoPoi.setText("Descripci칩n");
        lblDescripci칩nNuevoPoi.setFont(new java.awt.Font("Tahoma", 0, 12));
        panelDescripNuevoPoi.add(lblDescripci칩nNuevoPoi);

        campoDescripcionNuevoPoi.setMaximumSize(new java.awt.Dimension(200, 20));
        campoDescripcionNuevoPoi.setMinimumSize(new java.awt.Dimension(200, 20));
        campoDescripcionNuevoPoi.setPreferredSize(new java.awt.Dimension(200, 20));
        panelDescripNuevoPoi.add(campoDescripcionNuevoPoi);

        panelDatosPoi.add(panelDescripNuevoPoi);

        panelBtnAgregaPoi.setMaximumSize(new java.awt.Dimension(80, 500));
        panelBtnAgregaPoi.setMinimumSize(new java.awt.Dimension(80, 500));
        panelBtnAgregaPoi.setPreferredSize(new java.awt.Dimension(80, 500));

        btnAgregaPoi.setText("Agrega POI");
        btnAgregaPoi.setAutoscrolls(true);
        btnAgregaPoi.setMargin(new java.awt.Insets(2, 1, 2, 1));
        btnAgregaPoi.setMaximumSize(new java.awt.Dimension(70, 23));
        btnAgregaPoi.setMinimumSize(new java.awt.Dimension(70, 23));
        btnAgregaPoi.setPreferredSize(new java.awt.Dimension(70, 23));
        btnAgregaPoi.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAgregaPoiActionPerformed(evt);
            }
        });
        panelBtnAgregaPoi.add(btnAgregaPoi);

        panelDatosPoi.add(panelBtnAgregaPoi);

        panelSur.add(panelDatosPoi);

        panelPois.add(panelSur, java.awt.BorderLayout.SOUTH);

        panelTodo.add(panelPois);

        panelCategoriaPois.setMaximumSize(new java.awt.Dimension(500, 280));
        panelCategoriaPois.setMinimumSize(new java.awt.Dimension(500, 250));
        panelCategoriaPois.setPreferredSize(new java.awt.Dimension(500, 280));
        panelCategoriaPois.setScrollableTracksViewportHeight(false);
        panelCategoriaPois.setScrollableTracksViewportWidth(false);
        panelCategoriaPois.setLayout(new java.awt.BorderLayout());

        panelCatTitulo.setMaximumSize(new java.awt.Dimension(500, 30));
        panelCatTitulo.setMinimumSize(new java.awt.Dimension(500, 30));
        panelCatTitulo.setPreferredSize(new java.awt.Dimension(500, 30));
        panelCatTitulo.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT));

        lblTituloTablaCategorias.setText("Categor칤as de POIs:");
        lblTituloTablaCategorias.setFont(new java.awt.Font("Tahoma", 0, 14));
        panelCatTitulo.add(lblTituloTablaCategorias);

        panelCategoriaPois.add(panelCatTitulo, java.awt.BorderLayout.NORTH);

        panelTablaCategorias.setMaximumSize(new java.awt.Dimension(500, 200));
        panelTablaCategorias.setMinimumSize(new java.awt.Dimension(500, 200));
        panelTablaCategorias.setPreferredSize(new java.awt.Dimension(500, 200));
        panelTablaCategorias.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.CENTER, 0, 0));

        jScrollPane2.setMaximumSize(new java.awt.Dimension(500, 200));
        jScrollPane2.setMinimumSize(new java.awt.Dimension(500, 200));
        jScrollPane2.setPreferredSize(new java.awt.Dimension(500, 200));

        tablaCategorias.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null},
                {null, null},
                {null, null},
                {null, null}
            },
            new String [] {
                "Nombre de Categoria", "Icono"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.Object.class
            };
            boolean[] canEdit = new boolean [] {
                false, true
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane2.setViewportView(tablaCategorias);
        tablaCategorias.getColumnModel().getColumn(1).setMinWidth(50);
        tablaCategorias.getColumnModel().getColumn(1).setPreferredWidth(50);
        tablaCategorias.getColumnModel().getColumn(1).setMaxWidth(50);

        panelTablaCategorias.add(jScrollPane2);

        panelCategoriaPois.add(panelTablaCategorias, java.awt.BorderLayout.CENTER);

        panelAgregaCategoria.setMaximumSize(new java.awt.Dimension(500, 50));
        panelAgregaCategoria.setMinimumSize(new java.awt.Dimension(500, 50));
        panelAgregaCategoria.setPreferredSize(new java.awt.Dimension(500, 50));
        panelAgregaCategoria.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.CENTER, 5, 0));

        panelNombreNuevaCat.setMaximumSize(new java.awt.Dimension(300, 500));
        panelNombreNuevaCat.setMinimumSize(new java.awt.Dimension(300, 500));
        panelNombreNuevaCat.setPreferredSize(new java.awt.Dimension(300, 500));
        panelNombreNuevaCat.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.CENTER, 5, 10));

        lblNombreNuevaCat.setText("Nombre");
        lblNombreNuevaCat.setFont(new java.awt.Font("Tahoma", 0, 12));
        panelNombreNuevaCat.add(lblNombreNuevaCat);

        campoNombreNuevaCat.setMaximumSize(new java.awt.Dimension(170, 20));
        campoNombreNuevaCat.setMinimumSize(new java.awt.Dimension(170, 20));
        campoNombreNuevaCat.setPreferredSize(new java.awt.Dimension(170, 20));
        panelNombreNuevaCat.add(campoNombreNuevaCat);

        panelAgregaCategoria.add(panelNombreNuevaCat);

        panelBtnAgregaCategoria.setMaximumSize(new java.awt.Dimension(150, 500));
        panelBtnAgregaCategoria.setMinimumSize(new java.awt.Dimension(150, 500));
        panelBtnAgregaCategoria.setPreferredSize(new java.awt.Dimension(150, 500));
        panelBtnAgregaCategoria.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.CENTER, 5, 9));

        btnAgregaCategoria.setText("Agrega Categoria");
        btnAgregaCategoria.setAutoscrolls(true);
        btnAgregaCategoria.setMargin(new java.awt.Insets(2, 1, 2, 1));
        btnAgregaCategoria.setMaximumSize(new java.awt.Dimension(120, 23));
        btnAgregaCategoria.setMinimumSize(new java.awt.Dimension(120, 23));
        btnAgregaCategoria.setPreferredSize(new java.awt.Dimension(120, 23));
        btnAgregaCategoria.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAgregaCategoriaActionPerformed(evt);
            }
        });
        panelBtnAgregaCategoria.add(btnAgregaCategoria);

        panelAgregaCategoria.add(panelBtnAgregaCategoria);

        panelCategoriaPois.add(panelAgregaCategoria, java.awt.BorderLayout.SOUTH);

        panelTodo.add(panelCategoriaPois);

        jScrollPane3.setViewportView(panelTodo);

        add(jScrollPane3, java.awt.BorderLayout.LINE_END);
    }// </editor-fold>//GEN-END:initComponents

    private void comboCategoriasActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_comboCategoriasActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_comboCategoriasActionPerformed

    private void btnAgregaPoiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAgregaPoiActionPerformed
        //Boton de aceptar
       /* // Agrega/inserta POI:
        if (comboCategorias.getSelectedIndex() != -1 && campoDescripcionNuevoPoi.getText().length() > 2) {
        CategoriaPoi cP = (CategoriaPoi) comboCategorias.getSelectedItem();
        //tendria q pasar lat y long ahora
        controllers.ControllerPois.getInstance().agregaPOI(cP.getId(), campoDescripcionNuevoPoi.getText(), Integer.valueOf(campoLatitud.getText()), Integer.valueOf(campoLongitud.getText())); //son double pero no hay double.valueof
        //cargaGrillaPOIS();
        } else {
        JOptionPane.showMessageDialog(null, "No se selecciono una categoria o el nombre no es valido");
        }
         */
        //modifica POI
        if (modificandoPOI) {
            POI unPOI = getTempPOI();
            unPOI.setLatitud(Double.valueOf(campoLatitud.getText()));
            unPOI.setLongitud(Double.valueOf(campoLongitud.getText()));
            CategoriaPoi cP = (CategoriaPoi) comboCategorias.getSelectedItem();
            unPOI.setIdCategoriaPOI(cP.getId());
            unPOI.setDescripcion(campoDescripcionNuevoPoi.getText());
            controllers.ControllerPois.getInstance().modificaPOI(unPOI);
            setModificandoPOI(false);
            habilitaPanelDatosPOIs(false);
        }
        cargaGrillaPOIS();
    }//GEN-LAST:event_btnAgregaPoiActionPerformed

    private void btnAgregaCategoriaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAgregaCategoriaActionPerformed

        //verif si esta repetido
        boolean unico = true;
        int i = 0;
        while (i < comboCategorias.getItemCount() && unico) {
            if (comboCategorias.getItemAt(i).toString().toUpperCase().equals(campoDescripcionNuevoPoi.getText().toUpperCase())) {
                unico = false;
            }
            i++;
        }
        // Agrega Categoria POI:
        if (unico && campoNombreNuevaCat.getText().length() > 2) {
            controllers.ControllerPois.getInstance().agregaCategoriaPOI(campoNombreNuevaCat.getText());
            cargaGrillaCategoriaPOIS();
            cargaComboCategorias();
        } else {
            JOptionPane.showMessageDialog(null, "El nombre  de la categoria no es valido");
        }
    }//GEN-LAST:event_btnAgregaCategoriaActionPerformed

    private void btnInsertarActionPerformed(java.awt.event.ActionEvent evt) {
        //INSERTA un POI
        habilitaPanelDatosPOIs(true);



        /*Este es el codigo de resgistra POI
         * habilitaPanelDatosPOIs(true);
        campoLatitud.setText(String.valueOf(ControllerNavegacion.getInstance().getLatitudActual()));
        campoLatitud.setEnabled(false);//no lo puedo modificar
        campoLongitud.setText(String.valueOf(ControllerNavegacion.getInstance().getLongitudActual()));
        campoLongitud.setEnabled(false);//no lo puedo modificar
        //controlaPanelNuevaCondicion(true);
        setModificandoPOI(false);*/

    }

    private void btnModificarActionPerformed(java.awt.event.ActionEvent evt) {
        habilitaPanelDatosPOIs(true);
        setModificandoPOI(true);
        btnEliminar.setEnabled(false);
        btnInsertar.setEnabled(false);
        //cargo la fila seleccionada en el formulario
        int i = 0;
        while (!(Boolean) tablaPois.getValueAt(i, tablaPois.getColumnCount(false) - 1) && i < tablaPois.getRowCount() - 1) {
            i++;
        }
        if ((Boolean) tablaPois.getValueAt(i, tablaPois.getColumnCount(false) - 1)) {
            POI unPOI = (POI) tablaPois.getValueAt(i, 0);
            campoLatitud.setText(String.valueOf(unPOI.getLatitud()));
            campoLongitud.setText(String.valueOf(unPOI.getLongitud()));
            comboCategorias.setSelectedItem(BrokerCategoriasPOI.getInstance().getCatPOIFromDB(unPOI.getIdCategoriaPOI()));
            campoDescripcionNuevoPoi.setText(unPOI.getDescripcion());
            setTempPOI(unPOI);
        } else {
            habilitaPanelDatosPOIs(false);
            setModificandoPOI(false);
            JOptionPane.showMessageDialog(null, "Seleccione un POI primero");
        }

        /*setGuiModificarFilaElegida();
        setModificandoCampania(true);
        controlaPanelAccionesCampania();*/
    }

    private void btnGuardarActionPerformed(java.awt.event.ActionEvent evt) {
        //ver Hay que sacar el boton de abajo y pasar el codigo aca me parece
        /*
        if (guardarCampaniaModificada()) {
        setModificandoCampania(false);
        controlaPanelAccionesCampania();
        lblNuevaCampania.setText("Nueva Campa침a:");
        cargarDatosDeCampaniaEnCurso();
        }*/
    }

    private void btnEliminarActionPerformed(java.awt.event.ActionEvent evt) {
        if (JOptionPane.showConfirmDialog(null,
                "Desea eliminar los POIs seleccionados?",
                "Eliminar POIs",
                JOptionPane.YES_NO_OPTION,
                JOptionPane.WARNING_MESSAGE) == 0) {
            for (int i = 0; i < tablaPois.getRowCount(); i++) {
                if ((Boolean) tablaPois.getValueAt(i, tablaPois.getColumnCount(false) - 1)) {
                    controllers.ControllerPois.getInstance().eliminaPOI((POI) tablaPois.getValueAt(i, 0));
                }
            }
        }
        cargaGrillaPOIS();
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnAgregaCategoria;
    private javax.swing.JButton btnAgregaPoi;
    private org.jdesktop.swingx.JXHyperlink btnEliminar;
    private org.jdesktop.swingx.JXHyperlink btnGuardar;
    private org.jdesktop.swingx.JXHyperlink btnInsertar;
    private org.jdesktop.swingx.JXHyperlink btnModificar;
    private javax.swing.JTextField campoDescripcionNuevoPoi;
    private javax.swing.JTextField campoLatitud;
    private javax.swing.JTextField campoLongitud;
    private javax.swing.JTextField campoNombreNuevaCat;
    private javax.swing.JComboBox comboCategorias;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private org.jdesktop.swingx.JXLabel lblAccionesCampania;
    private org.jdesktop.swingx.JXLabel lblCategoria;
    private org.jdesktop.swingx.JXLabel lblDescripci칩nNuevoPoi;
    private org.jdesktop.swingx.JXLabel lblLatitud;
    private org.jdesktop.swingx.JXLabel lblLongitud;
    private org.jdesktop.swingx.JXLabel lblNombreNuevaCat;
    private org.jdesktop.swingx.JXLabel lblTitulo;
    private org.jdesktop.swingx.JXLabel lblTituloTablaCategorias;
    private org.jdesktop.swingx.JXLabel lblTituloTablaPois;
    private org.jdesktop.swingx.JXPanel panelAcciones;
    private org.jdesktop.swingx.JXPanel panelAccionesCampElegida;
    private org.jdesktop.swingx.JXPanel panelAgregaCategoria;
    private org.jdesktop.swingx.JXPanel panelBtnAgregaCategoria;
    private org.jdesktop.swingx.JXPanel panelBtnAgregaPoi;
    private org.jdesktop.swingx.JXPanel panelCatNuevoPoi;
    private org.jdesktop.swingx.JXPanel panelCatTitulo;
    private org.jdesktop.swingx.JXPanel panelCategoriaPois;
    private org.jdesktop.swingx.JXPanel panelDatosPoi;
    private org.jdesktop.swingx.JXPanel panelDescripNuevoPoi;
    private org.jdesktop.swingx.JXPanel panelLatitud;
    private org.jdesktop.swingx.JXPanel panelLongitud;
    private org.jdesktop.swingx.JXPanel panelNombreNuevaCat;
    private org.jdesktop.swingx.JXPanel panelPois;
    private org.jdesktop.swingx.JXPanel panelPoisTitulo;
    private org.jdesktop.swingx.JXPanel panelSur;
    private org.jdesktop.swingx.JXPanel panelTablaCategorias;
    private org.jdesktop.swingx.JXPanel panelTablaPois;
    private org.jdesktop.swingx.JXPanel panelTitulo;
    private org.jdesktop.swingx.JXPanel panelTodo;
    private org.jdesktop.swingx.JXTable tablaCategorias;
    private org.jdesktop.swingx.JXTable tablaPois;
    // End of variables declaration//GEN-END:variables

    public static PanelOpcPOIs getInstance() {
        if (unicaInstancia == null) {
            unicaInstancia = new PanelOpcPOIs();
        }
        return unicaInstancia;
    }

    private void inicializador() {
        try {
            cargaGrillaPOIS();
            cargaGrillaCategoriaPOIS();
            cargaComboCategorias();
            habilitaPanelDatosPOIs(false);
            //obtengo ide del selected recuperando el objeto:
            //CategoriaPoi s = (CategoriaPoi) comboCategorias.getSelectedItem();
            //s.getId();
        } catch (Exception e) {
            System.out.println(e);
        }
    }
    //main de prueba

    public static void main(String[] args) {
        javax.swing.JFrame elFrame = new javax.swing.JFrame();
        elFrame.setSize(500, 500);
        PanelOpcPOIs a = new PanelOpcPOIs();
        //cargaEspecies();
        elFrame.add(a);
        elFrame.setVisible(true);
    }

    private void cargaComboCategorias() {
        //carga combo
        comboCategorias.removeAllItems();
        for (CategoriaPoi cP : controllers.ControllerPois.getInstance().cargaCategoriasPOI()) {
            comboCategorias.addItem(cP);
        }
    }

    private void cargaGrillaCategoriaPOIS() {
        //DefaultTableModel dm = (DefaultTableModel) tablaCategorias.getModel(); 
        //modeloTablaCategoriasPOI = (DefaultTableModel) tablaCategorias.getModel();
        //tablaCategorias.setModel(modeloTablaCategoriasPOI);
        //---ControllerPpal.getInstance().vaciarJTable(modeloTablaCategoriasPOI);
        //dm.setRowCount(0);
        int cantCols = 4;
        //Cabecera
        /*String[] encabezado = new String[4];
        encabezado[0] = "id";
        encabezado[1] = "Nombre de la categoria";
        encabezado[2] = "Icono";
        encabezado[3] = "Acciones";
        dm.setColumnIdentifiers(encabezado);*/
        /*modeloTablaCategoriasPOI.addColumn("id");
        modeloTablaCategoriasPOI.addColumn("Nombre de la categoria");
        modeloTablaCategoriasPOI.addColumn("Icono");
        modeloTablaCategoriasPOI.addColumn("Acciones");*/
        //Cuerpo
        ArrayList a = new ArrayList();
        for (CategoriaPoi cP : BrokerCategoriasPOI.getInstance().getCatPOISFromDB()) {
            a.add(cP.getId());
            a.add(cP); //<-- Aca esta el objeto entero
            a.add(cP.getPathIcono());
            a.add("false");
            modeloTablaCategoriasPOI.addRow(ControllerPpal.getInstance().creaUnaFilaGenerica(cantCols, a));
            a.clear();
        }
        tablaCategorias.setModel(modeloTablaCategoriasPOI);
        //escondo la columna ID 
        ControllerPpal.getInstance().ocultarColJTable(tablaCategorias, 0);
    }

    private void cargaGrillaPOIS() {
        try {
            //DefaultTableModel dm = (DefaultTableModel) tablaPois.getModel();
            //modeloTablaPOIS = (DefaultTableModel) tablaPois.getModel();
            //tablaPois.setModel(modeloTablaPOIS);
            //---ControllerPpal.getInstance().vaciarJTable(modeloTablaPOIS);
            modeloTablaPOIS.setRowCount(0);//vacia la tabla
            //dm.setRowCount(0);
            int cantCols = 6;
            //Cabecera
            /*String[] encabezado = new String[6];
            encabezado[0] = "id";
            encabezado[1] = "Fecha y Hora";
            encabezado[2] = "Categoria";
            encabezado[3] = "Coordenadas";
            encabezado[4] = "Descripcion";
            encabezado[5] = "Acciones";
            modeloTablaPOIS.setColumnCount(cantCols-1);
            modeloTablaPOIS.setColumnIdentifiers(encabezado);*/
            // modeloTablaPOIS.setColumnCount(cantCols);
            /*modeloTablaPOIS.addColumn("id");
            modeloTablaPOIS.addColumn("Fecha y Hora");
            modeloTablaPOIS.addColumn("Categoria");
            modeloTablaPOIS.addColumn("Coordenadas");
            modeloTablaPOIS.addColumn("Descripcion");
            modeloTablaPOIS.addColumn("Acciones");*/

            //Cuerpo

            /*for (POI p : BrokerPOIs.getInstance().getPOISFromDB()) {
            dm.addRow(agregaUnaFilaPOI(p.getId(), p.getFechaHora(), BrokerCategoriasPOI.getInstance().getCatPOIFromDB(p.getIdCategoriaPOI()).getTitulo(), p.getDescripcion(), p.getLatitud(), p.getLongitud()));
            }*/
            ArrayList a = new ArrayList();
            for (POI p : BrokerPOIs.getInstance().getPOISFromDB()) {
                a.add(p); //agrega el objeto POI, pero muestra el id
                a.add(p.getFechaHora());
                a.add(BrokerCategoriasPOI.getInstance().getCatPOIFromDB(p.getIdCategoriaPOI()).getTitulo());
                String coordenadas = String.valueOf(p.getLatitud()) + "," + String.valueOf(p.getLongitud());
                a.add(coordenadas);
                a.add(p.getDescripcion());
                a.add("false");
                modeloTablaPOIS.addRow(ControllerPpal.getInstance().creaUnaFilaGenerica(cantCols, a));
                a.clear();
            }
        } catch (Exception e) {
            System.out.println(e);
        }
        tablaPois.setModel(modeloTablaPOIS);
        //escondo la columna ID 
        ControllerPpal.getInstance().ocultarColJTable(tablaPois, 0);
    }

    /**
     * @return the modificandoPOI
     */
    public boolean isModificandoPOI() {
        return modificandoPOI;
    }

    /**
     * @param modificandoPOI the modificandoPOI to set
     */
    public void setModificandoPOI(boolean modificandoPOI) {
        this.modificandoPOI = modificandoPOI;
    }

    private void habilitaPanelDatosPOIs(boolean estado) {
        campoLatitud.setEnabled(estado);
        campoLongitud.setEnabled(estado);
        campoDescripcionNuevoPoi.setEnabled(estado);
        campoNombreNuevaCat.setEnabled(estado);
        lblLatitud.setEnabled(estado);
        lblLongitud.setEnabled(estado);
        lblCategoria.setEnabled(estado);
        lblDescripci칩nNuevoPoi.setEnabled(estado);
        btnAgregaPoi.setEnabled(estado);
        //Limpio
        campoLatitud.setText("");
        campoLongitud.setText("");
        campoNombreNuevaCat.setText("");
        //si lo deshabilito habilito la barra
        if (!estado) {
            btnEliminar.setEnabled(!estado);
            btnInsertar.setEnabled(!estado);
            btnModificar.setEnabled(!estado);
            btnGuardar.setEnabled(!estado);
        }
    }

    /**
     * @return the tempPOI
     */
    public POI getTempPOI() {
        return tempPOI;
    }

    /**
     * @param tempPOI the tempPOI to set
     */
    public void setTempPOI(POI tempPOI) {
        this.tempPOI = tempPOI;
    }
}


/*
            if (metodoEscaneaIconos()>0){
 * while que carga el combo{
                //--- resize Icon
                Image source = new ImageIcon(modelo.dataCapture.Sistema.getInstance().getRutaIconosCatPois()+cP.getPathIcono()).getImage();
                BufferedImage image = new BufferedImage(source.getWidth(null), source.getHeight(null), BufferedImage.TYPE_INT_ARGB);
                Graphics2D g2d = (Graphics2D)image.getGraphics();
                g2d.drawImage(source, 0, 0, null);
                g2d.dispose();
                //-------------
                combo.addItem(modelo.dataCapture.Sistema.getInstance().getLabelWithImgResized(25, 32, image));//en la columna 2 va el Icono
            }
 }
 */