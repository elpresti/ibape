/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package gui;

import com.sun.script.javascript.JSAdapter;
import java.awt.Dimension;
import java.awt.Graphics2D;
import java.awt.Image;
import java.awt.image.BufferedImage;
import java.net.URL;
import javax.swing.ImageIcon;
import javax.swing.JLabel;
import javax.swing.JSplitPane;
import modelo.dataManager.AdministraCampanias;
import modelo.dataManager.UltimaImgProcesada;
import persistencia.Logueador;

/**
 *
 * @author Sebastian
 */
public class ProcesaImgWin extends javax.swing.JFrame {
    private static ProcesaImgWin unicaInstancia;
    
    /**
     * Creates new form ProcesaImgWin
     */
    private ProcesaImgWin() {
        initComponents();
        inicializador();
    }

    public static ProcesaImgWin getInstance() {
        if (unicaInstancia == null) {
            unicaInstancia = new ProcesaImgWin();
        }
        return unicaInstancia;
    }
    

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        panelSuperior = new org.jdesktop.swingx.JXPanel();
        lblTitulo = new org.jdesktop.swingx.JXLabel();
        panelCentro = new org.jdesktop.swingx.JXPanel();
        splitPanelPdi = new javax.swing.JSplitPane();
        imgSinProcesar = new javax.swing.JLabel();
        imgProcesada = new javax.swing.JLabel();
        panelInferior = new org.jdesktop.swingx.JXPanel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setName("ProcesaImgWin"); // NOI18N
        setPreferredSize(new java.awt.Dimension(700, 700));

        panelSuperior.setPreferredSize(new java.awt.Dimension(700, 30));

        lblTitulo.setText("Procesamiento de Imagenes");
        lblTitulo.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        panelSuperior.add(lblTitulo);

        getContentPane().add(panelSuperior, java.awt.BorderLayout.NORTH);

        panelCentro.setPreferredSize(new java.awt.Dimension(700, 620));

        splitPanelPdi.setDividerLocation(200);
        splitPanelPdi.setOrientation(javax.swing.JSplitPane.VERTICAL_SPLIT);
        splitPanelPdi.setContinuousLayout(true);
        splitPanelPdi.setOneTouchExpandable(true);
        splitPanelPdi.setPreferredSize(new java.awt.Dimension(296, 395));

        imgSinProcesar.setText("jLabel1");
        splitPanelPdi.setLeftComponent(imgSinProcesar);

        imgProcesada.setText("jLabel2");
        splitPanelPdi.setRightComponent(imgProcesada);

        panelCentro.add(splitPanelPdi);

        getContentPane().add(panelCentro, java.awt.BorderLayout.CENTER);

        panelInferior.setPreferredSize(new java.awt.Dimension(700, 50));
        getContentPane().add(panelInferior, java.awt.BorderLayout.SOUTH);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    /**
     * @param args the command line arguments
     */

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel imgProcesada;
    private javax.swing.JLabel imgSinProcesar;
    private org.jdesktop.swingx.JXLabel lblTitulo;
    private org.jdesktop.swingx.JXPanel panelCentro;
    private org.jdesktop.swingx.JXPanel panelInferior;
    private org.jdesktop.swingx.JXPanel panelSuperior;
    private javax.swing.JSplitPane splitPanelPdi;
    // End of variables declaration//GEN-END:variables

    private void inicializador() {
        //imgSinProcesar.setIcon(new ImageIcon("imgs\\img2.jpg"));
        //splitPanelPdi = new JSplitPane(JSplitPane.VERTICAL_SPLIT,imgSinProcesar,imgProcesada);
        //splitPanelPdi.setContinuousLayout(true);
        //splitPanelPdi.setOneTouchExpandable(true);
        //splitPanelPdi.setDividerLocation(200);

        //imgProcesada = getImgOnAresizedJlabel("imgs\\img1.jpg",600,400);
        //--- resize Icon
        Image source = new ImageIcon("imgs\\img1-proc.jpg").getImage();
        BufferedImage image = new BufferedImage(source.getWidth(null), source.getHeight(null), BufferedImage.TYPE_INT_ARGB);
        Graphics2D g2d = (Graphics2D)image.getGraphics();
        g2d.drawImage(source, 0, 0, null);
        g2d.dispose();
        //-------------
        int anchoPretendido=400;
        int altoPretendido=250;
        BufferedImage scaled = modelo.dataCapture.Sistema.getInstance().scaleImg(image, anchoPretendido, altoPretendido);
        imgProcesada.setIcon(new ImageIcon(scaled));
        imgProcesada.setPreferredSize(new Dimension(anchoPretendido, altoPretendido));      
        imgProcesada.setMinimumSize(new Dimension(0,0));
        imgSinProcesar.setMinimumSize(new Dimension(0,0));

        //imgSinProcesar = getImgOnAresizedJlabel("imgs\\img1-proc.jpg",600,400);        
    }
    
    public void mostrarVentana(boolean estado){
        this.setVisible(estado);
    }
    
    public void actualizaImgs(String rutaImgSinProcesar,String rutaImgProcesada){
        try{
            if (rutaImgProcesada == null || rutaImgProcesada.length()<2){
                rutaImgProcesada = "imgs\\imgWithDetectedMarks.tmp";
            }
            if (rutaImgSinProcesar == null || rutaImgSinProcesar.length()<2){
                rutaImgSinProcesar = AdministraCampanias.getInstance().getFullFolderHistoricoDeCampActual()
                        +"\\"+UltimaImgProcesada.getInstance().getFileName();
            }
            imgSinProcesar = new JLabel(new ImageIcon(rutaImgSinProcesar));
            imgProcesada = new JLabel(new ImageIcon(rutaImgProcesada));
        }catch(Exception e){
            Logueador.getInstance().agregaAlLog("actualizaImgs(): "+e.toString());
            imgProcesada = new JLabel(new ImageIcon("imgs\\imgNotFound.png"));
        }
    }
    
    public JLabel getImgOnAresizedJlabel(String rutaImg,int anchoSalida, int altoSalida){
        //--- resize Icon
        Image source = new ImageIcon(rutaImg).getImage();
        BufferedImage image = new BufferedImage(source.getWidth(null), source.getHeight(null), BufferedImage.TYPE_INT_ARGB);
        Graphics2D g2d = (Graphics2D)image.getGraphics();
        g2d.drawImage(source, 0, 0, null);
        g2d.dispose();
        //-------------
        return modelo.dataCapture.Sistema.getInstance().getLabelWithImgResized(anchoSalida, altoSalida, image);
    }
}